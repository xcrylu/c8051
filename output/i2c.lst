C51 COMPILER V9.01   I2C                                                                   11/25/2022 22:50:27 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN .\output\i2c.obj
COMPILER INVOKED BY: C:\Keil_v5-79\C51\BIN\C51.EXE driver\i2c.c COMPACT BROWSE INCDIR(.\driver) DEBUG OBJECTEXTEND CODE 
                    -SYMBOLS PRINT(.\output\i2c.lst) PREPRINT(.\output\i2c.i) OBJECT(.\output\i2c.obj)

line level    source

   1          
   2          
   3          //I2c.c
   4          #include "i2c.h"
   5          #include <intrins.h>
   6          
   7          void I2C_Start(void)                            // Ëµ∑ÂßãÊù°‰ª∂Â≠êÁ®ãÂ∫è
   8          {
   9   1              SDA = 1;
  10   1              SCL = 1;
  11   1              _nop_();
  12   1              SDA = 0;
  13   1              _nop_();
  14   1      }
  15          void I2C_Stop(void)                             // ÂÅúÊ≠¢Êù°‰ª∂Â≠êÁ®ãÂ∫è
  16          {
  17   1              SDA = 0;
  18   1              SCL = 1;
  19   1              _nop_();
  20   1              SDA = 1;
  21   1              _nop_();
  22   1      }
  23          void I2C_ACK(void)                              // Â∫îÁ≠îÂ≠êÁ®ãÂ∫è
  24          {
  25   1              SDA = 0;
  26   1              _nop_();
  27   1              SCL = 1;
  28   1              _nop_();
  29   1              SCL = 0;
  30   1      }
  31          
  32          void I2C_NCK(void)                              // Â∫îÁ≠îÂ≠êÁ®ãÂ∫è
  33          {
  34   1              SCL = 0;
  35   1              SDA = 1;
  36   1              _nop_();
  37   1              SCL = 1;
  38   1              _nop_();
  39   1              SCL = 0;
  40   1      }
  41          
  42          /**
  43          * ËØªACKÔºå
  44          * ËøîÂõûÂÄºÔºö  0   ÔºõNCK
  45          *           1   ÔºöACK
  46          */
  47          unsigned char  I2C_CheckACK(void)
  48          {       
  49   1              unsigned char ret = 0;
  50   1              SCL = 0;
  51   1              SDA = 1;//…Ë÷√SDAŒ™ ‰»Î
  52   1              SCL = 1;
  53   1              _nop_();
  54   1      
C51 COMPILER V9.01   I2C                                                                   11/25/2022 22:50:27 PAGE 2   

  55   1              if(SDA==1)  ret = 0;
  56   1              else ret =  1;
  57   1      
  58   1              SCL = 0;
  59   1      
  60   1              return ret;
  61   1                      
  62   1      }
  63          void I2C_WriteByte(unsigned char ch)                    // ÂèëÈÄÅÊï∞ÊçÆÂ≠êÁ®ãÂ∫è,ch‰∏∫Ë¶ÅÂèëÈÄÅÁöÑÊï∞ÊçÆ
  64          {
  65   1              unsigned char BitCounter = 8;           //‰ΩçÊï∞ÊéßÂà∂
  66   1              unsigned char tmp;                                      //‰∏≠Èó¥ÂèòÈáèÊéßÂà∂
  67   1              do
  68   1              {
  69   2                      tmp = ch;
  70   2                      SCL = 0;
  71   2                      _nop_();
  72   2                      if ((tmp&0x80)==0x80)   //Â¶ÇÊûúÊúÄÈ´ò‰ΩçÊòØÔºë
  73   2                              SDA = 1;
  74   2                      else
  75   2                              SDA = 0;
  76   2                      SCL = 1;
  77   2                      tmp = ch<<1;                    //Â∑¶Áßª
  78   2                      ch = tmp; 
  79   2                      BitCounter--;                   
  80   2              } while(BitCounter);
  81   1      
  82   1              SCL = 0;
  83   1      }
  84          
  85          unsigned char I2C_ReadByte(void)
  86          {
  87   1              unsigned char BitCounter = 8;           //‰ΩçÊï∞ÊéßÂà∂
  88   1              unsigned char tmp=0;                                    //‰∏≠Èó¥ÂèòÈáèÊéßÂà∂
  89   1              for(;BitCounter>0;BitCounter--)
  90   1              {
  91   2                      
  92   2                      SCL = 0;
  93   2                      SDA = 1;//…Ë÷√SDAŒ™ ‰»Îœﬂ
  94   2                      _nop_();                                
  95   2                      SCL = 1;
  96   2                      _nop_();
  97   2                      if (1==SDA)     //Â¶ÇÊûúÊòØÔºë
  98   2                              tmp |= 0x01<<(BitCounter-1);            
  99   2              }       
 100   1              SCL = 0;        
 101   1              return tmp;             
 102   1      }
C51 COMPILER V9.01   I2C                                                                   11/25/2022 22:50:27 PAGE 3   

ASSEMBLY LISTING OF GENERATED OBJECT CODE


             ; FUNCTION I2C_Start (BEGIN)
                                           ; SOURCE LINE # 7
                                           ; SOURCE LINE # 8
                                           ; SOURCE LINE # 9
0000 D291              SETB    SDA
                                           ; SOURCE LINE # 10
0002 D290              SETB    SCL
                                           ; SOURCE LINE # 11
0004 00                NOP     
                                           ; SOURCE LINE # 12
0005 C291              CLR     SDA
                                           ; SOURCE LINE # 13
0007 00                NOP     
                                           ; SOURCE LINE # 14
0008 22                RET     
             ; FUNCTION I2C_Start (END)

             ; FUNCTION I2C_Stop (BEGIN)
                                           ; SOURCE LINE # 15
                                           ; SOURCE LINE # 16
                                           ; SOURCE LINE # 17
0000 C291              CLR     SDA
                                           ; SOURCE LINE # 18
0002 D290              SETB    SCL
                                           ; SOURCE LINE # 19
0004 00                NOP     
                                           ; SOURCE LINE # 20
0005 D291              SETB    SDA
                                           ; SOURCE LINE # 21
0007 00                NOP     
                                           ; SOURCE LINE # 22
0008 22                RET     
             ; FUNCTION I2C_Stop (END)

             ; FUNCTION I2C_ACK (BEGIN)
                                           ; SOURCE LINE # 23
                                           ; SOURCE LINE # 24
                                           ; SOURCE LINE # 25
0000 C291              CLR     SDA
                                           ; SOURCE LINE # 26
0002 00                NOP     
                                           ; SOURCE LINE # 27
0003 D290              SETB    SCL
                                           ; SOURCE LINE # 28
0005 00                NOP     
                                           ; SOURCE LINE # 29
0006 C290              CLR     SCL
                                           ; SOURCE LINE # 30
0008 22                RET     
             ; FUNCTION I2C_ACK (END)

             ; FUNCTION I2C_NCK (BEGIN)
                                           ; SOURCE LINE # 32
                                           ; SOURCE LINE # 33
                                           ; SOURCE LINE # 34
0000 C290              CLR     SCL
                                           ; SOURCE LINE # 35
0002 D291              SETB    SDA
                                           ; SOURCE LINE # 36
C51 COMPILER V9.01   I2C                                                                   11/25/2022 22:50:27 PAGE 4   

0004 00                NOP     
                                           ; SOURCE LINE # 37
0005 D290              SETB    SCL
                                           ; SOURCE LINE # 38
0007 00                NOP     
                                           ; SOURCE LINE # 39
0008 C290              CLR     SCL
                                           ; SOURCE LINE # 40
000A 22                RET     
             ; FUNCTION I2C_NCK (END)

             ; FUNCTION I2C_CheckACK (BEGIN)
                                           ; SOURCE LINE # 47
                                           ; SOURCE LINE # 48
                                           ; SOURCE LINE # 49
;---- Variable 'ret' assigned to Register 'R7' ----
0000 E4                CLR     A
0001 FF                MOV     R7,A
                                           ; SOURCE LINE # 50
0002 C290              CLR     SCL
                                           ; SOURCE LINE # 51
0004 D291              SETB    SDA
                                           ; SOURCE LINE # 52
0006 D290              SETB    SCL
                                           ; SOURCE LINE # 53
0008 00                NOP     
                                           ; SOURCE LINE # 55
0009 309102            JNB     SDA,?C0005
000C 8002              SJMP    ?C0006
000E         ?C0005:
                                           ; SOURCE LINE # 56
000E 7F01              MOV     R7,#01H
0010         ?C0006:
                                           ; SOURCE LINE # 58
0010 C290              CLR     SCL
                                           ; SOURCE LINE # 60
                                           ; SOURCE LINE # 62
0012         ?C0007:
0012 22                RET     
             ; FUNCTION I2C_CheckACK (END)

             ; FUNCTION _I2C_WriteByte (BEGIN)
                                           ; SOURCE LINE # 63
;---- Variable 'ch' assigned to Register 'R7' ----
                                           ; SOURCE LINE # 64
                                           ; SOURCE LINE # 65
;---- Variable 'BitCounter' assigned to Register 'R6' ----
0000 7E08              MOV     R6,#08H
0002         ?C0010:
                                           ; SOURCE LINE # 68
                                           ; SOURCE LINE # 69
;---- Variable 'tmp' assigned to Register 'R5' ----
0002 AD07              MOV     R5,AR7
                                           ; SOURCE LINE # 70
0004 C290              CLR     SCL
                                           ; SOURCE LINE # 71
0006 00                NOP     
                                           ; SOURCE LINE # 72
0007 ED                MOV     A,R5
0008 30E704            JNB     ACC.7,?C0011
                                           ; SOURCE LINE # 73
000B D291              SETB    SDA
C51 COMPILER V9.01   I2C                                                                   11/25/2022 22:50:27 PAGE 5   

000D 8002              SJMP    ?C0012
000F         ?C0011:
                                           ; SOURCE LINE # 75
000F C291              CLR     SDA
0011         ?C0012:
                                           ; SOURCE LINE # 76
0011 D290              SETB    SCL
                                           ; SOURCE LINE # 77
0013 EF                MOV     A,R7
0014 25E0              ADD     A,ACC
0016 FD                MOV     R5,A
                                           ; SOURCE LINE # 78
0017 FF                MOV     R7,A
                                           ; SOURCE LINE # 79
0018 DEE8              DJNZ    R6,?C0010
                                           ; SOURCE LINE # 80
                                           ; SOURCE LINE # 82
001A C290              CLR     SCL
                                           ; SOURCE LINE # 83
001C 22                RET     
             ; FUNCTION _I2C_WriteByte (END)

             ; FUNCTION I2C_ReadByte (BEGIN)
                                           ; SOURCE LINE # 85
                                           ; SOURCE LINE # 86
                                           ; SOURCE LINE # 87
;---- Variable 'BitCounter' assigned to Register 'R7' ----
0000 7F08              MOV     R7,#08H
                                           ; SOURCE LINE # 88
;---- Variable 'tmp' assigned to Register 'R6' ----
0002 E4                CLR     A
0003 FE                MOV     R6,A
                                           ; SOURCE LINE # 89
0004         ?C0014:
                                           ; SOURCE LINE # 90
                                           ; SOURCE LINE # 92
0004 C290              CLR     SCL
                                           ; SOURCE LINE # 93
0006 D291              SETB    SDA
                                           ; SOURCE LINE # 94
0008 00                NOP     
                                           ; SOURCE LINE # 95
0009 D290              SETB    SCL
                                           ; SOURCE LINE # 96
000B 00                NOP     
                                           ; SOURCE LINE # 97
000C 309110            JNB     SDA,?C0016
                                           ; SOURCE LINE # 98
000F EF                MOV     A,R7
0010 14                DEC     A
0011 FD                MOV     R5,A
0012 7401              MOV     A,#01H
0014 A805              MOV     R0,AR5
0016 08                INC     R0
0017 8002              SJMP    ?C0020
0019         ?C0019:
0019 C3                CLR     C
001A 33                RLC     A
001B         ?C0020:
001B D8FC              DJNZ    R0,?C0019
001D 4E                ORL     A,R6
001E FE                MOV     R6,A
C51 COMPILER V9.01   I2C                                                                   11/25/2022 22:50:27 PAGE 6   

                                           ; SOURCE LINE # 99
001F         ?C0016:
001F DFE3              DJNZ    R7,?C0014
0021         ?C0015:
                                           ; SOURCE LINE # 100
0021 C290              CLR     SCL
                                           ; SOURCE LINE # 101
0023 AF06              MOV     R7,AR6
                                           ; SOURCE LINE # 102
0025         ?C0018:
0025 22                RET     
             ; FUNCTION I2C_ReadByte (END)

C51 COMPILER V9.01   I2C                                                                   11/25/2022 22:50:27 PAGE 7   

NAME                                    CLASS   MSPACE  TYPE    OFFSET  SIZE
====                                    =====   ======  ====    ======  ====


P1 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0090H  1
P3 . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B0H  1
IE . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00A8H  1
IP . . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00B8H  1
I2C_Start. . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
I2C_ReadByte . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  BitCounter . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  tmp. . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0006H  1
SCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0098H  1
TCON . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   0088H  1
_I2C_WriteByte . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  ch . . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
  BitCounter . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0006H  1
  tmp. . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0005H  1
I2C_Stop . . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
I2C_CheckACK . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
  ret. . . . . . . . . . . . . . . . .  * REG *  DATA   U_CHAR   0007H  1
SDA. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0091H  1
SCL. . . . . . . . . . . . . . . . . .  ABSBIT   -----  BIT      0090H  1
T2CON. . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00C8H  1
I2C_ACK. . . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----
PSW. . . . . . . . . . . . . . . . . .  SFR      DATA   U_CHAR   00D0H  1
I2C_NCK. . . . . . . . . . . . . . . .  PUBLIC   CODE   PROC     0000H  -----


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    124    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
